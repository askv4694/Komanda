---
title: "Klasifikavimas"
author: "Asta KvedaraitÄ— & Marius Survila"
date: "5/27/2020"
output: html_document
---

```{r echo = FALSE, message=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  error = TRUE,
  echo = FALSE 
)
```

```{r}

getGroup <- function(test, known, k){
  names <- c()   
  testtypes <- c()
  for (i in 1: nrow(test)){
     testing <- rbind(test[i,], known)
     d <- dist(testing,  method = "euclidean")
     m <- min(d)
     d <- as.matrix(d)
     d <- as.data.frame(d)
     d <- d[,1]
     max <- sort(d[d > 0])[1:k]
     #print (max)
     indnames <- c()
     
     for (j in 1 : length(max)){
       ind <- which(d==max[j])[1]
      # print(rownames(known)[ind])
       indnames[j] <- rownames(testing[ind,])
     }
     types <- c()
     for (n in 1: length(indnames)){
       #print(indnames[n])
       #print(as.character(corrected$sample[corrected$sample_id == indnames[n]]))
       types[n] <- as.character(corrected$sample[corrected$sample_id == indnames[n]])
      # print(types[n])
     }
     t <- table(types)
     #print(t)
     if (is.na(t[2]) == FALSE){
       if (t[1] > t[2]){
         testtypes[i] <- names(t[1])
       }else{
         testtypes[i] <- names(t[2])
       }
     }else{
       testtypes[i] <- names(t[1])
     }
     
  }
  return(testtypes)
}

```

```{r}
getTested <- function(test){
  names <- rownames(test)
  dat <- c()
  for (i in 1: length(names)){
    dat[i] <- as.character(corrected$sample[corrected$sample_id == names[1]])
  }
  return(dat)
}

```

```{r}
getFailed <- function(matrix){
  tr <- 0
  fl <- 0
  for (i in 1:nrow(matrix)){
    if (matrix$group[i] == matrix$tested[i]){
        tr <- tr+1
    }else{
      fl <- fl +1
    }
  }
  
  return(fl/tr)
}

```

```{r}
corrected <- read.csv("../output/correctedSample.csv")
data <- readRDS("../output/betab.rds")
```


```{r}
#Randomly shuffle the data

sample<-data[sample(nrow(data)),]

#Create 10 equally size folds
folds <- cut(seq(2,ncol(sample)),breaks=10, labels = FALSE)
#Perform 10 fold cross validation
for(i in 1:10){
  #Segement your data by fold using the which() function 
  testIndexes <- which(folds==i,arr.ind=TRUE)
  testData <- sample[,testIndexes ]
  knownData <- sample[,-testIndexes ]
  #Use the test and train data partitions however you desire...
}

```

```{r}

testData <- t(testData[1:5,])
knownData <- t(knownData[1:5,])
testData <- as.data.frame(testData)
knownData <- as.data.frame(knownData)
#ncol(testData)
#nrow(testData)
#ncol(knownData)


```



```{r}

group <- getGroup(testData, knownData, 3)
tested <- getTested(testData)
mat <- as.data.frame(cbind(group, tested))

getFailed(mat)
```