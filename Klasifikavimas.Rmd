---
title: "Klasifikavimas"
author: "Asta Kvedaraitė & Marius Survila"
date: "5/27/2020"
output: html_document
---

```{r echo = FALSE, message=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  error = TRUE,
  echo = FALSE 
)
```

```{r}
#Atsirenka pagal vidurkį- jei metilinamos reikšmės > vidurkį daugiau, tuomet tinka
getSmaller <- function(tdata){
  tdata <- knownData
  cols <- c()
  for (i in 1:ncol(tdata)){
    tab <- table(tdata[,i] > mean(tdata[,i]))
    true <- 0
    false <- 0
    if (names(tab[1]) == FALSE){
      false <- 1
      true <- 2
    }else{
      true <- 1
      false <- 2
    }
    if (tab[[true]] > tab[[false]]){
      #print(names(tdata[1]))
      cols[i] <- names(tdata[i])
    }
    
  }
  cols <- cols[!is.na(cols)]
  cols
  return(unique(cols))
}

```

```{r}

#K-kaimynai
getGroup <- function(test, known, k){
  names <- c()
  cols <- getSmaller(known)
  known <- known[,cols]
  test <- test[,cols]
  testtypes <- c()
  for (i in 1: nrow(test)){
     testing <- rbind(test[i,], known)
     d <- dist(testing,  method = "euclidean")
     m <- min(d)
     d <- as.matrix(d)
     d <- as.data.frame(d)
     d <- d[,1]
     #Mažiausi atstumai, tiek kiek k(kaimynai)
     max <- sort(d[d > 0])[1:k]
     indnames <- c()
     
     for (j in 1 : length(max)){
       ind <- which(d==max[j])[1]
       indnames[j] <- rownames(testing[ind,])
     }
     types <- c()
     #Gauti visi samples (serga/neserga pagal mėginio ID)
     for (n in 1: length(indnames)){
       types[n] <- as.character(corrected$sample[corrected$sample_id == indnames[n]])
     }
     t <- table(types)
     if (is.na(t[2]) == FALSE){
       if (t[1] > t[2]){
         testtypes[i] <- names(t[1])
       }else{
         testtypes[i] <- names(t[2])
       }
     }else{
       testtypes[i] <- names(t[1])
     }
     
  }
  #grąžina kiekvieno test mėginio spėjimą - sveikas ar sergantis
  return(testtypes)
}

```

```{r}
#Gauti reikšmes pagal ID, kokios yra teisingos(testiniams)
getTested <- function(test){
  names <- rownames(test)
  dat <- c()
  for (i in 1: length(names)){
    dat[i] <- as.character(corrected$sample[corrected$sample_id == names[1]])
  }
  return(dat)
}

```

```{r}
#gauti paklaidos reikšmę
getFailed <- function(matrix){
  tr <- 0
  fl <- 0
  for (i in 1:nrow(matrix)){
    if (matrix$group[i] == matrix$tested[i]){
        tr <- tr+1
    }else{
      fl <- fl +1
    }
  }
  
  return(fl/tr)
}

```

```{r}
corrected <- read.csv("../output/correctedSample.csv")
data <- readRDS("../output/betab.rds")
```


```{r}
#Randomly shuffle the data

sample<-data[sample(nrow(data[1:100,])),]

#Create 10 equally size folds
folds <- cut(seq(2,ncol(sample)),breaks=10, labels = FALSE)
#Perform 10 fold cross validation
rez <- c()
#for(i in 1:10){
  #Segement your data by fold using the which() function 
  testIndexes <- which(folds==i,arr.ind=TRUE)
  testData <- sample[,testIndexes ]
  knownData <- sample[,-testIndexes ]
  
  testData <- as.data.frame(testData)
  knownData <- as.data.frame(knownData)
  group <- getGroup(testData, knownData, 3)
  tested <- getTested(testData)
  mat <- as.data.frame(cbind(group, tested))
  #rez[i] <- 
  getFailed(mat)
  #Use the test and train data partitions however you desire...
#}

```

```{r}


testData <- t(testData[1:200,])
knownData <- t(knownData[1:200,])


```



```{r}


```